#ifndef GSM_MQTT_H_
#include <avr/pgmspace.h>
#endif

#define GPS Serial2
extern bool readGPS;

const uint8_t ecoPowerMode[10]= {0xB5, 0x62, 0x06, 0x11, 0x02, 0x00, 0x08, 0x04, 0x25, 0x95};
const uint8_t updateInterval[16] = {0xB5, 0x62, 0x06, 0x08, 0x06, 0x00, 0x88, 0x13, 0x01, 0x00,
		 						 0x01, 0x00, 0xB1, 0x49}; // Change update interval to 1 second 
const uint8_t DisableGGA[18]={0xB5, 0x62, 0x06, 0x01, 0x08, 0x00, 0xF0, 0x00, 0x00, 0x00, 0x00,
						 0x00, 0x00, 0x01, 0x00, 0x24}; // disabling GGA output
const uint8_t DisableGGL[18]={0xB5, 0x62, 0x06, 0x01, 0x08, 0x00, 0xF0, 0x01, 0x00, 0x00, 0x00,
						 0x00, 0x00, 0x01, 0x01, 0x2B}; // diabling GGL output
const uint8_t DisableGSA[18]={0xB5, 0x62, 0x06, 0x01, 0x08, 0x00, 0xF0, 0x02, 0x00, 0x00, 0x00,
						 0x00, 0x00, 0x01, 0x02, 0x32}; // disabling GSA output 
const uint8_t DisableGSV[18]={0xB5, 0x62, 0x06, 0x01, 0x08, 0x00, 0xF0, 0x03, 0x00, 0x00, 0x00,
						 0x00, 0x00, 0x01, 0x03, 0x39}; // disabling GSV output 
const uint8_t DisableVTG[18]={0xB5, 0x62, 0x06, 0x01, 0x08, 0x00, 0xF0, 0x05, 0x00, 0x00, 0x00,
						 	0x00, 0x00, 0x01, 0x05, 0x47};  // disabling VTG output
const uint8_t GPRMC_UART[18]={0xB5, 0x62, 0x06, 0x01, 0x08, 0x00, 0xF0, 0x04, 0x00, 0x01, 0x00,
						    0x00, 0x00, 0x01, 0x04, 0x45};  // enable GPRMC output

// global variable
char gps_coordinate[128];

void serialEvent2();
void GPSConfig();
void writeConfig(const uint8_t *setting, const uint8_t len);

void GPSConfig() {
  GPS.begin(9600);
  delay(2000);
  writeConfig(updateInterval, 16);
  writeConfig(ecoPowerMode, 10);
  writeConfig(DisableGGA, 18);
  writeConfig(DisableGGL, 18);
  writeConfig(DisableGSA, 18);
  writeConfig(DisableGSV, 18);
  writeConfig(DisableVTG, 18);
  writeConfig(GPRMC_UART, 18);
}

// write configuration to gps (ublox)
void writeConfig(const uint8_t *setting, const uint8_t len) {
  for (uint8_t i=0; i<len; i++) {
  	GPS.write((char)setting[i]);
  }
}

// Read buffer from serial hardware 2
void serialEvent2() {
  // lastLocation = GPS.available();
  GPS.readBytesUntil(13, gps_coordinate, 128);
  GPS.clear();
  readGPS = strstr(gps_coordinate, "$GPRMC") ? true: false;
}
